<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.spc.dao.UserDao" >

  <resultMap id="userMap" type="com.spc.model.UserDomain">
    <id property="uid" column="uid"/>
    <result property="userName" column="userName"/>
    <result property="password" column="password"/>
    <result property="stuId" column="stuId"/>
    <association property="role"  column="uid" select="selectRole"/>
  </resultMap>

  <select id="selectRole" resultType="com.spc.model.RoleDomain">
  select r.roleName,r.roleId
  from
  (select  u.uid, ru.roleId
  from User u
  left join Role_user ru
  on u.uid = ru.uid
  ) a
  left join Role r
  on a.roleId = r.roleId
  where a.uid = #{id}
  </select>



  <sql id="BASE_TABLE">
    User
  </sql>

  <sql id="BASE_COLUMN">
    uid,userName,password,num
  </sql>



  <select id="findUsersByName" resultMap="userMap">
      SELECT *
      FROM
        <include refid="BASE_TABLE"/>
      <where>
        userName = #{userName}
      </where>
  </select>
  <select id="findUsersById" resultMap="userMap">
      SELECT *
      FROM
        <include refid="BASE_TABLE"/>
      <where>
        stuId = #{userId}
      </where>
  </select>

  <insert id = "insert" useGeneratedKeys="true" keyProperty="uid" parameterType="com.spc.model.UserDomain" keyColumn="uid">
      insert  into  User (userName, password, stuId) values(#{userName}, #{password}, #{stuId})
    <selectKey keyProperty="uid" resultType="int" order="AFTER">
    SELECT LAST_INSERT_ID();
  </selectKey>
  </insert>


</mapper>